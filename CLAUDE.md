# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要
複数のAWSアカウントのコスト削減取り組みの効果測定と、削減優先度検討のための可視化ツールを開発する。
requirements.mdに要件の詳細を記載している。

## 技術スタック
- **HTML5** - 基本構造とUI
- **Vanilla JavaScript** - CSV読み込み・データ処理・DOM操作
- **Chart.js** - グラフ描画ライブラリ（軽量で高機能）
- **CSS3** - スタイリング

フレームワークは使用せず、シンプルな静的サイトとして構築。CSVファイルの読み込みと可視化に特化した軽量な実装。

## プロジェクト構造
```
├── index.html              # メインページ
├── css/
│   └── style.css          # スタイルシート
├── js/
│   ├── app.js             # メイン処理・UI制御
│   ├── csv-parser.js      # CSV解析・データ変換
│   └── chart-config.js    # Chart.js設定・グラフ生成
├── resources/             # CSVデータ配置
│   ├── dev/costs.csv      # 開発環境コストデータ
│   ├── prod/costs.csv     # 本番環境コストデータ
│   └── staging/costs.csv  # ステージング環境コストデータ
├── requirements.md        # 機能要件定義
└── README.md             # プロジェクト説明
```

## データ構造・取得方式
### アカウント登録ベース
- ユーザーがローカルCSVファイルをアップロード
- アカウント名は手動入力（dev, prod, staging等）
- 複数アカウントデータをブラウザ内で管理
- sessionStorageでデータ永続化

### 登録フロー
1. アカウント名入力 + CSVファイル選択
2. 「アカウントを追加」で登録
3. 登録済みアカウント一覧で管理
4. 複数登録後「データ分析開始」で可視化

### CSVファイル仕様
- 各CSVは同じ基本形式だが、利用サービスに応じて列の増減あり
- File APIで動的読み込み・解析
- アカウント名は固定ではなく柔軟に設定可能

## 開発ワークフロー
### 開発サーバー起動
```bash
# シンプルなHTTPサーバーを起動（Python 3.x）
python -m http.server 8000

# または Node.js がある場合
npx serve .
```

### ファイル確認・利用方法
- `index.html` - ブラウザで http://localhost:8000 にアクセス
- アカウント登録フォームでCSVファイルをアップロード
- 複数アカウント登録後、データ分析・可視化機能を利用

### デプロイ
静的ファイルのみなので、任意のWebサーバーやGitHub Pagesに配置可能。

## Git コミットルール
### コミット単位の基準
- **機能単位**: 1つの機能追加・修正は1コミットにまとめる
- **ファイル種別**: HTML、CSS、JSなど異なる種類の変更でも関連する機能なら同一コミット
- **ドキュメント**: 機能に関連するドキュメント更新は機能コミットに含める
- **設定ファイル**: プロジェクト設定の変更は独立したコミット

### コミットメッセージ形式
```
動詞 + 対象 + 簡潔な説明

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### 例
- `Add CSV parser and data visualization components`
- `Fix chart rendering issue for empty data`
- `Update project documentation and development guide`
- `Refactor data processing for better performance`

### プッシュタイミング
- 機能が完成してテストが通った段階で速やかにプッシュ
- 複数の小さな関連コミットは一度にプッシュしても可

## 開発ログ管理
### development-log.md 運用ルール
- **継続更新**: 主要な開発活動・技術的決定を随時記録
- **記録タイミング**: 
  - 新機能実装完了時
  - 重要な技術的決定時
  - 問題解決・バグ修正時
  - プロジェクト構成変更時
- **記録内容**:
  - 日付・概要
  - 実施内容（詳細な作業項目）
  - 技術的決定事項と理由
  - 作成・更新したファイル
  - Git操作履歴（コミットハッシュ）
- **フォーマット**: 日付ごとのセクション形式で時系列記録

## テスト戦略・ワークフロー
### テスト実装ルール
- **テスト駆動開発**: 機能実装と並行してテストを作成
- **機能完了時テスト**: 1機能開発完了毎に必ず関連テストを実装
- **回帰テスト**: 機能完了毎に全テストスイートを実行
- **テスト必須タイミング**:
  - 新機能実装完了時
  - バグ修正完了時
  - リファクタリング完了時
  - プルリクエスト作成前

### テスト環境
- **フレームワーク**: Jest + JSDOM
- **テストタイプ**:
  - Unit Tests: 個別関数・モジュールテスト
  - Integration Tests: 複数モジュール連携テスト
  - Multi-account Tests: 複数アカウントデータ処理テスト
- **テストコマンド**:
  - `npm test` - 全テスト実行
  - `npm run test:watch` - 監視モード
  - `npm run test:coverage` - カバレッジ付き実行

### テストデータ構造
```
tests/fixtures/
├── multi-account/     # dev, prod, staging環境データ
├── edge-cases/        # 空データ、異常データ、異なるサービス構成
└── expected-results/  # 期待される処理結果データ
```

### 品質基準
- **テストカバレッジ**: 主要ロジック80%以上
- **テスト実行**: 機能完了毎の必須実行
- **テスト成功**: 全テストパス後のみコミット許可

## E2E テスト・操作検証
### Playwright操作検証ルール
- **実施タイミング**: 
  - UI機能実装完了時
  - JavaScript機能追加・修正時
  - フェーズ完了時
  - プルリクエスト作成前
- **検証内容**:
  - USER_MANUAL.md記載の操作手順に沿った検証
  - 主要ユーザーフローの動作確認
  - エラーハンドリングの動作確認
  - レスポンシブ対応の確認
- **検証方法**:
  - Playwright MCPでブラウザ操作
  - 各操作ステップの成功・失敗記録
  - スクリーンショット取得（必要時）
  - コンソールエラーの確認

### E2Eテスト実施基準
- **必須実施**: UI変更・JS機能追加時
- **推奨実施**: CSS変更・レイアウト修正時
- **記録必須**: 問題発見時は詳細記録・修正対応
- **マニュアル連動**: 操作手順変更時はマニュアル同期更新

### テスト環境
- **ブラウザアクセス**: `file://` または `http://localhost:8000`
- **テストデータ**: `tests/fixtures/` 配下のCSVファイル活用
- **検証項目**: アカウント登録→データ処理→可視化の全フロー

### Issue管理・記録ルール
- **Issue発見時の対応**:
  - 即座にISSUES.mdに詳細記録
  - Issue ID（連番）で管理
  - 発見日時・症状・再現手順を記録
  - 重要度（Critical/High/Medium/Low）設定
- **Issue記録内容**:
  - **基本情報**: ID、タイトル、発見日、重要度
  - **症状詳細**: 期待動作 vs 実際動作
  - **再現手順**: 具体的なステップ
  - **環境情報**: ブラウザ、OS、ファイル等
  - **修正状況**: Open/In Progress/Fixed/Verified
- **修正完了基準**:
  - コード修正完了
  - Unit/E2Eテストでの修正確認
  - Playwright操作検証での再検証完了
- **Issue更新ルール**:
  - 修正着手時: ステータス更新
  - 修正完了時: 修正内容・日時記録
  - 検証完了時: Verifiedに更新

## タスク管理・進捗追跡
### task-progress.md 運用ルール
- **進捗管理**: 実装計画を詳細タスクに分解し、ステータス管理
- **ステータス定義**:
  - 🔲 **未実施**: まだ開始していないタスク
  - 🔄 **対応中**: 現在実装中のタスク
  - ✅ **完了**: 実装・テスト完了済みタスク
- **更新タイミング**:
  - タスク開始時: 未実施→対応中
  - タスク完了時: 対応中→完了
  - 新規タスク発生時: 表への追加
  - 計画変更時: タスク内容・優先度修正
- **管理内容**:
  - フェーズ別タスク分類
  - 担当ファイル明記
  - テスト実装タスクも含む
  - 進捗サマリー更新
- **継続更新**: 作業計画修正・追加作業発生時の都度反映
